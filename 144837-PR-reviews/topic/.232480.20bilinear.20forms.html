---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html
---

<h2>Stream: <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html">#2480 bilinear forms</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="194963719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/194963719" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#194963719">(Apr 22 2020 at 17:20)</a>:</h4>
<p><span class="user-mention" data-user-id="238446">@Anne Baanen</span> has made a really nice PR with the definition of bilinear forms. At some point in the theory, you need to konw that <code>2</code> is invertible in the base ring. We need to make a design choice here. I would like to have some more eyes and brains on this code. Will the current approach play well, or should we try something else?</p>



<a name="194972204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/194972204" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#194972204">(Apr 22 2020 at 18:26)</a>:</h4>
<p>½ is such a fundamental thing. Maybe it even makes sense to add a type class specifically for this.</p>



<a name="194972814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/194972814" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#194972814">(Apr 22 2020 at 18:31)</a>:</h4>
<p>I agree. Characteristic different from <code>2</code> is an assumption that shows up really often (notably when dealing with quadratic forms :)</p>



<a name="194973202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/194973202" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#194973202">(Apr 22 2020 at 18:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms/near/194972204" title="#narrow/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms/near/194972204">said</a>:</p>
<blockquote>
<p>½ is such a fundamental thing. Maybe it even makes sense to add a type class specifically for this.</p>
</blockquote>
<p>I like the notation!</p>



<a name="194982845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/194982845" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#194982845">(Apr 22 2020 at 19:52)</a>:</h4>
<p>½ or <code>2 ≠ 0</code>?</p>



<a name="194982889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/194982889" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#194982889">(Apr 22 2020 at 19:52)</a>:</h4>
<p>Probably ½</p>



<a name="194983593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/194983593" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#194983593">(Apr 22 2020 at 19:58)</a>:</h4>
<p>You need ½ for this quadratic forms business (e.g., Z[½] is fine even though it's not a field, but Z is not even though 2 ≠ 0). But it's not clear to me how to organize it with respect to the algebraic hierarchy.</p>



<a name="194983638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/194983638" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#194983638">(Apr 22 2020 at 19:58)</a>:</h4>
<p>I mean, obviously you need some axioms about ½</p>



<a name="194984876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/194984876" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#194984876">(Apr 22 2020 at 20:08)</a>:</h4>
<p><code>is_unit 2</code>?</p>



<a name="194984942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/194984942" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#194984942">(Apr 22 2020 at 20:08)</a>:</h4>
<p>Or <code>½ * 2 = 2 * ½ = 1</code> if we want to allow computable instances (probably yes).</p>



<a name="195017190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/195017190" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#195017190">(Apr 23 2020 at 04:13)</a>:</h4>
<p>So, maybe we add <code>has_half</code> as a class that only captures the data of the term and enables the notation (like <code>has_zero</code> and <code>has_one</code>) and another class</p>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">two_invertible</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">R</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">has_half</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">half_mul_two</span> <span class="o">:</span> <span class="err">½</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">(</span><span class="n">two_mul_half</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">*</span> <span class="err">½</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>
</pre></div>


<p>What do people think of this idea? (In particular, I'd like to know what <span class="user-mention" data-user-id="238446">@Anne Baanen</span> thinks.)</p>



<a name="195017253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/195017253" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#195017253">(Apr 23 2020 at 04:14)</a>:</h4>
<p>(I don't know if <code>semiring R</code> can be weakened... you need <code>1</code>, <code>2</code> and <code>*</code>. So you probably need <code>has_one</code>, <code>has_mul</code> and <code>has_add</code>? Maybe also <code>has_zero</code>?</p>



<a name="195017915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/195017915" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#195017915">(Apr 23 2020 at 04:30)</a>:</h4>
<p>Why not parameterize this over <code>2</code>?</p>



<a name="195017922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/195017922" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#195017922">(Apr 23 2020 at 04:31)</a>:</h4>
<p>like <code>invertible a</code> for numeral <code>a</code></p>



<a name="195017932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/195017932" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#195017932">(Apr 23 2020 at 04:31)</a>:</h4>
<p>I'm not a fan of the notation though. It's a bit hard to see in a monospace font</p>



<a name="195017987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/195017987" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#195017987">(Apr 23 2020 at 04:32)</a>:</h4>
<p>plus it's yet another way to express this constant, making simp normal form more complicated</p>



<a name="195018195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/195018195" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#195018195">(Apr 23 2020 at 04:38)</a>:</h4>
<p>I like the idea of parametrising. We need a "characteristic does not divide the order of G" class, and <code>invertible (fintype.card G)</code> seems pretty good.</p>



<a name="195018199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/195018199" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#195018199">(Apr 23 2020 at 04:38)</a>:</h4>
<p>Is there any reasonable definition of <code>has_div</code> for Z[1/2] that does some suitable truncation?</p>



<a name="195018292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/195018292" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#195018292">(Apr 23 2020 at 04:40)</a>:</h4>
<p>I would really like to be able to use <code>1 / 2</code> if possible. <code>rat.cast</code> already does division by zero sometimes if you are in a ring with the wrong characteristic</p>



<a name="195018574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/195018574" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#195018574">(Apr 23 2020 at 04:48)</a>:</h4>
<p>I would propose <code>(a * 2^b) / (c * 2^d)</code> (where a and c are odd) evaluates to <code>2^(b-d) * (a / c)</code> with the division evaluated in Z</p>



<a name="195018593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232480%20bilinear%20forms/near/195018593" class="zl"><img src="http://robertylewis.com/website_test/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="http://robertylewis.com/website_test/stream/144837-PR-reviews/topic/.232480.20bilinear.20forms.html#195018593">(Apr 23 2020 at 04:49)</a>:</h4>
<p>that should give the correct result in all reasonable cases, returns 0 on division by 0, and is a kind of p-adic approximation otherwise</p>



{% endraw %}

<hr><p>Last updated: Apr 23 2020 at 06:01 UTC</p>